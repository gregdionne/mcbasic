10 DIM STACK(50)
20 SP=0:L=16384:H=16895:GOSUB 100
30 END
100 A=PEEK(L)
110 B=PEEK(H)
120 IF A>B THEN POKEH,A:POKEL,B
130 Z=INT((H-L)/2)
140 IF Z<1 THEN RETURN
150 Z=Z+L
160 A=PEEK(Z)
170 IF A<PEEK(L) THEN A=PEEK(L)
180 IF A>PEEK(H) THEN A=PEEK(H)
190 LP=L:HP=H
200 IF A<=PEEK(LP) THEN 220
210 LP=LP+1:GOTO200
220 IF LP=HP THEN 270
230 IF A>PEEK(HP) THEN 250
240 HP=HP-1:GOTO220
250 IF LP=HP THEN 270
260 T=PEEK(LP):POKELP,PEEK(HP):POKEHP,T:GOTO200
270 IF A<>PEEK(L) OR L=H THEN 290
280 L=L+1:GOTO270
290 IF LP<L THEN LP=L
300 STACK(SP)=LP:STACK(SP+1)=H:SP=SP+2
310 H=LP:GOSUB100
320 SP=SP-2:L=STACK(SP):H=STACK(SP+1)
330 GOTO100
